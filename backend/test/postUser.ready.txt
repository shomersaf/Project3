const { expect } = require("chai")
const axios = require("axios")

describe("POST /users/new", function(){
  
  it("Create new user - success ", async function () {
    const dummyUser = {
      firstName:"dummy",
      lastName:"user1",
      email: `email${Date.now()}@gmail.com`,
      pswrd:"dummy", 
      userRole:"user"
    }
    const result = await axios.post("http://localhost:4001/users/new", dummyUser)
    expect(result.status).equal(200)
});

it("Create new user - wrong email format", async function () {
  try {
      const dummyEmail = `email${Date.now()}@gmail.com`
      const dummyUser = {
        firstName:"dummy1",
        lastName:"user1",
        email: `email`,
        pswrd:"dummy", 
        userRole:"user"
      }
      const result = await axios.post("http://localhost:4001/users/new", dummyUser)
      throw new Error("TEST FAILED")
  } catch (error) {
      expect(error?.response.status).equal(400)
  }
});

it("Create new user - no data entered", async function () {
  try {
      const dummyEmail = `email${Date.now()}@gmail.com`
      const dummyUser = {
        firstName:"",
        lastName:"user1",
        email: `email${Date.now()}@gmail.com`,
        pswrd:"dummy", 
        userRole:"user"
      }
      const result = await axios.post("http://localhost:4001/users/new", dummyUser)
      throw new Error("TEST FAILED")
  } catch (error) {
      expect(error?.response.status).equal(400)
  }
});

it("Create new user - too short data", async function () {
  try {
      const dummyEmail = `email${Date.now()}@gmail.com`
      const dummyUser = {
        firstName:"a",
        lastName:"user1",
        email: `email${Date.now()}@gmail.com`,
        pswrd:"dummy", 
        userRole:"user"
      }
      const result = await axios.post("http://localhost:4001/users/new", dummyUser)
      throw new Error("TEST FAILED")
  } catch (error) {
      expect(error?.response.status).equal(400)
  }
});


it("Create new user - irrelevant password", async function () {
  try {
      const dummyUser = {
        firstName:"12345",
        lastName:"user1",
        email: `email${Date.now()}@gmail.com`,
        pswrd:"du", 
        userRole:"user"
      }
      const result = await axios.post("http://localhost:4001/users/new", dummyUser)
      throw new Error("TEST FAILED")
  } catch (error) {
      expect(error?.response.status).equal(400)
  }
});

it("Create new user - User already exists ", async function () {
  try {
      const dummyEmail = `email${Date.now()}@gmail.com`
      const dummyUser = {
        firstName:"dummy1",
        lastName:"user1",
        email: `email${Date.now()}@blabla.com`,
        pswrd:"dummy", 
        userRole:"user"
      }
      const result1 = await axios.post("http://localhost:4001/users/new", dummyUser)
      const result2 = await axios.post("http://localhost:4001/users/new", dummyUser)
      throw new Error("TEST FAILED")
  } catch (error) {
      expect(error?.response.status).equal(400)
  }
});
})